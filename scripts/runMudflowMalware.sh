#!/bin/bash

# Like the other mudflow script, but for malware.
androidPlatforms="$ANDROID_HOME/platforms"

dirToAnalyze=$(realpath -s $1)
originalDir=$(pwd)

cd mudflow

mkdir -p malwarelogging

find ${dirToAnalyze} ! -name '*.*' | \
	xargs -n 1 -I{} -P 50 \
	sh -c \
		'timeout 60 \
		java -Xmx8g -cp "libs/*" soot.jimple.infoflow.android.TestApps.Test {} ${1} \
		> malwarelogging/$(basename {}).log 2>& 1 \
		&& echo "Finished java -Xmx8g -cp "libs/*" soot.jimple.infoflow.android.TestApps.Test {} ${1}"' \
	"sh" "${androidPlatforms}"

cd ${originalDir}
